(function(e){function t(t){for(var a,s,o=t[0],c=t[1],l=t[2],m=0,d=[];m<o.length;m++)s=o[m],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&d.push(i[s][0]),i[s]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);h&&h(t);while(d.length)d.shift()();return r.push.apply(r,l||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],a=!0,o=1;o<n.length;o++){var c=n[o];0!==i[c]&&(a=!1)}a&&(r.splice(t--,1),e=s(s.s=n[0]))}return e}var a={},i={naver:0},r=[];function s(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=a,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(n,a,function(t){return e[t]}.bind(null,a));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var h=c;r.push([1,"chunk-vendors","chunk-common"]),n()})({1:function(e,t,n){e.exports=n("8791")},"67c0":function(e,t,n){"use strict";var a=n("a6c2"),i=n.n(a);i.a},8791:function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("chats-wrapper",{ref:"chatsWrapper",attrs:{"key-field":"commentNo","time-field":"modTimeGmt","message-field":"contents",chat:e.renderData,"no-live-tips":e.$i18n.noLiveNaver.replace("${platform}",e.channelName),"show-chats":e.showChats,"disable-input":!e.showChats||e.isPlatformClose,"max-input-character":e.maxInputCharactor},on:{"live-init":e.handleLiveInit,"live-end":e.handleLiveEnd,"live-platform-close":e.handlePlatformClose,"handle-pull-up":e.handlePullUp,"handle-cached-exceed":e.handleCachedExceed,"re-broadcast":e.handleReBroadcast,"handle-send":e.handleSend},scopedSlots:e._u([{key:"chat",fn:function(t){var a=t.item;return[n("template-naver",{attrs:{isDev:e.isDev,data:a,"is-vlive-fanship":e.prismParams&&e.prismParams.isVliveFanship},on:{"handle-delete":e.handleDelete,"handle-report":e.handleReport,"handle-retry":e.handleRetry,"show-operation-buttons":function(e){a._isShowErrorHandleBtns=!0}}})]}}])})},r=[],s=(n("a4d3"),n("e01a"),n("99af"),n("4de4"),n("7db0"),n("c740"),n("4160"),n("caad"),n("c975"),n("a434"),n("b0c0"),n("d3b7"),n("ac1f"),n("2532"),n("3ca3"),n("841c"),n("159b"),n("ddb0"),n("2b3d"),n("2909")),o=n("5530"),c=n("de36"),l=n("eb9e"),h=n("7ea6"),m=n("2f14"),d=n("2869"),u=n("993d"),f=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"chat-info-item naver-chat-item",class:{"is-self":e.data._isSelf,"is-manager":e.data._isManager}},[n("div",{staticClass:"chat-content"},[n("div",{staticClass:"title"},[e.isShowFanship(e.data)?n("i",{staticClass:"icon-fanship"}):e._e(),n("div",{staticClass:"author-name"},[n("span",[e._v(e._s(e.data.userName))])]),!e.data._isSelf&&!e.data._isManager&&e.data.extension&&e.data.extension.lv?n("div",{staticClass:"level"},[n("i",{staticClass:"separate-dot"}),e._v(" LVL"+e._s(e.data.extension.lv)+" ")]):e._e()]),n("div",{staticClass:"message"},[e.data.stickerId?n("img",{staticClass:"message-emoji",attrs:{src:e.getChatImageUrl,alt:""}}):e._e(),n("span",[e._v(e._s(e.data.contents))])]),n("div",{staticClass:"chat-sup"},[n("span",{staticClass:"publish-time"},[e._v(e._s(e.data.timeago))]),e.data._isSelf||e.data._isManager?e._e():[n("i",{staticClass:"separate-dot"}),n("button",{staticClass:"btn-report",on:{click:e.handleReport}},[e._v(e._s(e.$i18n.report))])]],2),e.data._isSelf?n("div",{staticClass:"chat-btns"},[e.data._sendError?[e.data._isShowErrorHandleBtns?n("div",[n("button",{staticClass:"btn-retry",attrs:{"data-title":e.$i18n.tooltip.retry},on:{click:e.handleRetry}}),n("btn-close",{attrs:{"is-small":"","data-title":e.$i18n.tooltip.deleteText},on:{click:function(t){return e.handleDelete(!0)}}})],1):n("button",{staticClass:"btn-send-error",attrs:{"data-title":e.$i18n.tooltip.sendError},on:{click:e.showButtons}})]:n("btn-close",{staticClass:"chat-btn-close",attrs:{"is-small":"","data-title":e.$i18n.tooltip.deleteText},on:{click:e.handleDelete}})],2):e._e()])])},p=[],v=n("4d06"),g={name:"templateNaver",components:{BtnClose:v["a"]},props:{data:{type:Object,default:function(){return{}}},isVliveFanship:{type:Boolean},isDev:Boolean},computed:{getChatImageUrl:function(){return"".concat(this.isDev?c["VLIVE_CHAT_IMAGE_BASE_URL"]:c["VLIVE_CHAT_IMAGE_BASE_URL_PRO"]).concat(this.data.stickerId,".png")}},methods:{isShowFanship:function(){return!(!this.isVliveFanship||this.data._isSelf)&&(this.data.extension?this.data.extension.chps:void 0)},handleReport:function(){this.$emit("handle-report",this.data)},handleDelete:function(e){this.$emit("handle-delete",this.data,e)},handleRetry:function(){this.$emit("handle-retry",this.data)},showButtons:function(){this.$emit("show-operation-buttons")}}},C=g,_=(n("67c0"),n("2877")),b=Object(_["a"])(C,f,p,!1,null,null,null),x=b.exports,N={name:"prismNaver",components:{ChatsWrapper:u["a"],TemplateNaver:x},data:function(){return{channel:"",chatData:[],isLiving:!1,showChats:!1,prismParams:{},commentManager:null,reportedIDs:[],sendErrorList:[],noMorePreviousComment:!1,pageSize:50,pollTime:5e3,showLoading:!1,bufferManager:null,isPlatformClose:!1,isDev:!1}},computed:{isVlive:function(){return this.channel===c["CHANNEL"].VLIVE},renderData:function(){return this.chatData.concat(this.sendErrorList)},maxInputCharactor:function(){return this.isVlive?c["MAX_INPUT_CHARACTER_VLIVE"]:c["MAX_INPUT_CHARACTER_NAVERTV"]},channelName:function(){return this.channel&&c["CHANNEL_NAME"][this.channel]}},methods:{handleLiveInit:function(e){var t=this;if(console.log("handleLiveInit",e),!this.isLiving&&(this.clearPage(),e&&e.platforms&&(this.prismParams=e.platforms.find((function(e){return e.name===t.channel})),this.isDev=-1!==this.prismParams.GLOBAL_URI.indexOf("dev-"),this.prismParams))){if(this.prismParams.isRehearsal)return;this.isPlatformClose=!1,this.showChats=!0,this.isLiving=!0,this.handleCommentManagerInit(),this.bufferManager=new h["a"](this.chatData,{pollTime:this.pollTime})}},handlePlatformClose:function(e){e.platform===this.channel&&(this.isPlatformClose=!0)},handleLiveEnd:function(){this.isLiving=!1},handleCommentManagerInit:function(){var e=this;this.commentManager||(this.commentManager=new d["a"](Object(o["a"])({type:this.channel,pollTime:this.pollTime,pageSize:this.pageSize},this.prismParams)),this.commentManager.on("NEW_COMMENTS",(function(t){switch(t.type){case"last":e.handlePreviousComment(t.list);break;case"next":e.handleImmediateComment(t.list);break}})),this.commentManager.start())},handlePreviousComment:function(e){if(e.length){var t,n=this.filterCommentData(e);if(n.length)(t=this.chatData).push.apply(t,Object(s["a"])(n))}},handleImmediateComment:function(e){if(e.length){var t=this.filterCommentData(e,!0);t.length&&this.bufferManager.push(t)}},filterCommentData:function(e,t){var n=this,a=[],i=e.reverse(),r=new Date;return i.forEach((function(e){if(!n.reportedIDs.includes(e.userIdNo)){e.extension&&(e.extension=Object(m["a"])(decodeURIComponent(e.extension)));var i=n.getUserPermission(e),s=i.isSelf,o=i.isManager;e._isSelf=s,e._isManager=o,e.timeago=t?Object(l["a"])(r,n.$lang):Object(l["a"])(e.modTimeGmt,n.$lang),a.push(e)}})),a},clearPage:function(){this.platformClose=!1,this.showChats=!1,this.chatData=[],this.prismParams={},this.reportedIDs=[],this.sendErrorList=[],this.noMorePreviousComment=!1,this.clearCommentManager(),this.clearBufferManager()},clearCommentManager:function(){this.commentManager&&(this.commentManager.stop(),this.commentManager=null)},clearBufferManager:function(){this.bufferManager&&(this.bufferManager.clearTimer(),this.bufferManager=null)},handleReport:function(e){var t=this,n=this.$i18n,a=n.notice,i=n.confirm,r=i.reportText,o=i.cancelButton,l=n.alert,h=l.confirmButton,m=l.defaultText;this.$confirm({title:a,content:r,confirmText:h,cancelText:o}).then((function(){t.commentManager.request.repComment(e.commentNo).then((function(){var n;t.reportedIDs.push(e.userIdNo);var a=t.chatData.filter((function(t){return t.userIdNo!==e.userIdNo}));t.chatData.length=0,(n=t.chatData).push.apply(n,Object(s["a"])(a)),c["CHANNEL_ON_ALL_PAGE"].includes(t.channel)&&window.sendToPrism(JSON.stringify({type:"broadcast",data:{receive:"ALL",type:"report",data:e.userIdNo}}))})).catch((function(){t.$alert({title:a,content:m,confirmText:h}).then((function(){}))}))})).catch((function(){}))},handleDelete:function(e,t){var n=this,a=this.$i18n,i=a.notice,r=a.confirm,s=r.deleteText,o=r.deleteConfirmButton,l=r.cancelButton,h=a.alert,m=h.defaultText,d=h.confirmButton;this.$confirm({title:i,content:s,confirmText:o,cancelText:l}).then((function(){t?n.handleDeleteSendErrorItem(e):n.commentManager.request.delComment(e.commentNo).then((function(){var t=n.chatData.indexOf(e);t>-1&&n.chatData.splice(t,1),c["CHANNEL_ON_ALL_PAGE"].includes(n.channel)&&window.sendToPrism(JSON.stringify({type:"broadcast",data:{receive:"ALL",type:"delete",data:e.commentNo}}))})).catch((function(){n.$alert({title:i,content:m,confirmText:d}).then((function(){}))}))})).catch((function(){}))},handleDeleteSendErrorItem:function(e){var t=this.sendErrorList.findIndex((function(t){return t.commentNo===e.commentNo}));t>-1&&this.sendErrorList.splice(t,1)},handleSend:function(e){var t=this;this.commentManager.request.sendComment({commentType:"txt",contents:e}).then((function(e){var n;(n=t.chatData).push.apply(n,Object(s["a"])(t.filterCommentData(e)))})).catch((function(n){var a=t.$i18n,i=a.notice,r=a.alert,s=r.confirmButton,o=r.defaultText,c=r.sensitiveText;"5020"===n.code?t.$alert({title:i,content:c,confirmText:s}):t.$alert({title:i,content:o,confirmText:s}).then((function(){var n=t.prismParams,a=new Date;t.sendErrorList.push({commentNo:Symbol(),modTimeGmt:a,_isSelf:!0,_isManager:!1,timeago:Object(l["a"])(a,t.$lang),extension:n.extension,userName:n.username,contents:e,_sendError:!0,_isShowErrorHandleBtns:!1,_isSending:!1})}))}))},handleRetry:function(e){var t=this;e._isSending||(e._isSending=!0,this.commentManager.request.sendComment({commentType:"txt",contents:e.contents}).then((function(n){var a;t.handleDeleteSendErrorItem(e),(a=t.chatData).push.apply(a,Object(s["a"])(t.filterCommentData(n)))})).catch((function(){var n=t.$i18n,a=n.notice,i=n.alert,r=i.confirmButton,s=i.defaultText;t.$alert({title:a,content:s,confirmText:r}).then((function(){})),e._isShowErrorHandleBtns=!1})).finally((function(){e._isSending=!1})))},getUserPermission:function(e){var t=!1,n=!1;switch(this.channel){case c["CHANNEL"].VLIVE:var a=e.extension&&e.extension.cno==this.prismParams.extension.cno,i=e.extension&&e.extension.no==this.prismParams.extension.no;i?(t=!0,this.prismParams.username!==e.userName&&(this.prismParams.username=e.userName)):(a||e.manager)&&(n=!0);break;case c["CHANNEL"].NAVERTV:t=this.prismParams.userId===e.userIdNo,n=!t&&e.manager;break}return{isSelf:t,isManager:n}},handlePullUp:function(){var e=this;if(!this.noMorePreviousComment&&!this.showLoading){this.showLoading=!0;var t=this.chatData[0];this.commentManager.request.getOlderComment(t.commentNo,this.pageSize).then((function(t){if(e.showLoading=!1,t.length){var n,a=e.filterCommentData(t);if(a.length)(n=e.chatData).unshift.apply(n,Object(s["a"])(a)),e.$nextTick((function(){e.$refs.chatsWrapper&&e.$refs.chatsWrapper.$refs.scroller.scrollToItem(a.length-1)}))}else e.noMorePreviousComment=!0})).catch((function(){e.showLoading=!1}))}},handleCachedExceed:function(){var e=this.chatData.length;if(!(e<=c["MAX_CACHED_CHAT_COUNT"])){var t=e-c["MAX_CACHED_CHAT_COUNT"]+.1*c["MAX_CACHED_CHAT_COUNT"];this.chatData.splice(0,t),this.noMorePreviousComment=!1}},handleReBroadcast:function(e){if(e=Object(m["a"])(e),e.receive===this.channel)switch(e.type){case"delete":var t=this.chatData.findIndex((function(t){return t.commentNo===e.data}));-1!==t&&this.chatData.splice(t,1);break}}},created:function(){var e=new URLSearchParams(document.location.search).get("platform")||"";if(this.channel=e.toLocaleUpperCase(),![c["CHANNEL"].NAVERTV,c["CHANNEL"].VLIVE].includes(this.channel))throw new Error("Please take the correct platform name on url")},beforeDestroy:function(){this.clearCommentManager(),this.clearBufferManager()}},E=N,M=Object(_["a"])(E,i,r,!1,null,null,null),T=M.exports;n("21af");n("58d1").default(a["a"]),n("a514").default(a["a"]),a["a"].config.productionTip=!1,new a["a"]({render:function(e){return e(T)}}).$mount("#app")},a6c2:function(e,t,n){}});